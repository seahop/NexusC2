[websocket]
port = "3131"
cert_file = "/app/certs/ws_server.crt"
key_file = "/app/certs/ws_server.key"

[web_server]
cert_file = "/app/certs/web_server.crt"
key_file = "/app/certs/web_server.key"

[rpc_server]
cert_file = "/app/certs/rpc_server.crt"
key_file = "/app/certs/rpc_server.key"

# =============================================================================
# REST API CONFIGURATION
# =============================================================================
[rest_api]
port = "8443"
cert_file = "/app/certs/api_server.crt"
key_file = "/app/certs/api_server.key"

[rest_api.jwt]
# JWT token expiry durations
access_expiry = "1h"      # Access token lifetime
refresh_expiry = "24h"    # Refresh token lifetime

[rest_api.rate_limit]
# Rate limiting per IP address
requests_per_minute = 100

[rest_api.cors]
# Allowed origins for CORS (use ["*"] to allow all)
allowed_origins = ["*"]

# =============================================================================
# URL CONFIGURATION
# =============================================================================

[redirect_site]
url = "https://google.com"

# =============================================================================
# SERVER HEADERS - Global default headers applied to ALL listener responses
# =============================================================================
# These are base-layer security/identity headers applied to every response.
# Profile-specific headers (from http_profiles.server_response) are applied on top.

[server_headers]
server = "nginx/1.18.0"
strict_transport_security = "max-age=31536000; includeSubDomains"
x_frame_options = "DENY"
x_content_type_options = "nosniff"

# =============================================================================
# HTTP PROFILES - Named profiles for malleable traffic patterns
# =============================================================================
# Define multiple GET, POST, and server response profiles
# When creating a listener, bind specific profiles together
# Payloads built for that listener will use the bound configuration

# -----------------------------------------------------------------------------
# GET PROFILES - Define how agents poll for commands
# -----------------------------------------------------------------------------

[[http_profiles.get]]
name = "default-get"
path = "/api/v1/status"
method = "GET"
[[http_profiles.get.headers]]
name = "Accept"
value = "application/json"
[[http_profiles.get.params]]
name = "client"
location = "query"
type = "clientID_param"
format = "%CLIENTID%"

[[http_profiles.get]]
name = "microsoft-graph-get"
path = "/v1.0/me/drive/root/children"
method = "GET"
[[http_profiles.get.headers]]
name = "Authorization"
value = "Bearer %CLIENTID%"
[[http_profiles.get.headers]]
name = "Accept"
value = "application/json"
[[http_profiles.get.params]]
name = "Authorization"
location = "header"
type = "clientID_param"
format = "Bearer %CLIENTID%"

[[http_profiles.get]]
name = "aws-s3-get"
path = "/bucket/objects"
method = "GET"
[[http_profiles.get.headers]]
name = "x-amz-content-sha256"
value = "UNSIGNED-PAYLOAD"
[[http_profiles.get.params]]
name = "continuation-token"
location = "query"
type = "clientID_param"
format = "%CLIENTID%"

# -----------------------------------------------------------------------------
# POST PROFILES - Define how agents send results
# -----------------------------------------------------------------------------

[[http_profiles.post]]
name = "default-post"
path = "/api/v1/data"
method = "POST"
content_type = "application/json"
[[http_profiles.post.headers]]
name = "Content-Type"
value = "application/json"
[[http_profiles.post.params]]
name = "client"
location = "query"
type = "clientID_param"
format = "%CLIENTID%"

[[http_profiles.post]]
name = "microsoft-graph-post"
path = "/v1.0/me/drive/items"
method = "PUT"
content_type = "application/json"
[[http_profiles.post.headers]]
name = "Authorization"
value = "Bearer %CLIENTID%"
[[http_profiles.post.headers]]
name = "Content-Type"
value = "application/json"
[[http_profiles.post.params]]
name = "Authorization"
location = "header"
type = "clientID_param"
format = "Bearer %CLIENTID%"

[[http_profiles.post]]
name = "aws-s3-post"
path = "/bucket/objects"
method = "PUT"
content_type = "application/octet-stream"
[[http_profiles.post.headers]]
name = "x-amz-date"
value = "%TIMESTAMP%"
[[http_profiles.post.params]]
name = "x-amz-meta-id"
location = "header"
type = "clientID_param"
format = "%CLIENTID%"

# -----------------------------------------------------------------------------
# SERVER RESPONSE PROFILES - Define how server responds to agents
# -----------------------------------------------------------------------------

[[http_profiles.server_response]]
name = "default-response"
content_type = "application/json"
status_field = "status"
data_field = "data"
command_id_field = "id"
rekey_value = "refresh"
[[http_profiles.server_response.headers]]
name = "Cache-Control"
value = "no-store"

[[http_profiles.server_response]]
name = "microsoft-graph-response"
content_type = "application/json; odata.metadata=minimal"
status_field = "@odata.context"
data_field = "value"
command_id_field = "@odata.nextLink"
rekey_value = "TokenExpired"
[[http_profiles.server_response.headers]]
name = "x-ms-ags-diagnostic"
value = "{\"ServerInfo\":{\"DataCenter\":\"West US\"}}"

[[http_profiles.server_response]]
name = "aws-s3-response"
content_type = "application/xml"
status_field = "Code"
data_field = "Contents"
command_id_field = "NextContinuationToken"
rekey_value = "ExpiredToken"
[[http_profiles.server_response.headers]]
name = "x-amz-request-id"
value = "%UUID%"

# =============================================================================
# PAYLOAD CONFIGURATION
# =============================================================================

[payload_config]
sleep = 20
jitter = 10

# Malleable command values - customize these to avoid detection signatures
[payload_config.malleable_commands]
# The value that will replace 'rekey' in cleartext communication
# Agent will be compiled to recognize this value as the rekey command
# Change this to any value to remove 'rekey' signature from network traffic and binary
rekey = "bloop"

# JSON field names for rekey response - customize to avoid structural fingerprinting
# These control the field names in the JSON response sent over the wire
# Default: {"status": "bloop", "data": "", "command_db_id": 1}
# Custom:  {"x": "bloop", "y": "", "z": 1}
rekey_status_field = "status"
rekey_data_field = "data"
rekey_id_field = "id"

[payload_config.http_headers]
user_agent = "Mozilla/5.0 (Windows NT 10.0; Win64; x64)"
content_type = "application/json"

[[payload_config.http_headers.custom_headers]]
name = "X-Custom-Header"
value = "custom-value"
[[payload_config.http_headers.custom_headers]]
name = "X-Forward-For"
value = "127.0.0.1"
[[payload_config.http_headers.custom_headers]]
name = "Accept"
value = "*/*"
[[payload_config.http_headers.custom_headers]]
name = "Accept-Language"
value = "en-US,en;q=0.9"
[[payload_config.http_headers.custom_headers]]
name = "Connection"
value = "close"

# =============================================================================
# SMB LINK CONFIGURATION
# =============================================================================
# Settings for SMB-based agent linking (lateral movement)

[smb_link]
# Connection settings
connection_timeout = 30        # Timeout for pipe connections in seconds
max_message_size = 1048576     # Maximum message size in bytes (1MB)
heartbeat_interval = 60        # Heartbeat interval in seconds for detecting dead links

# Malleable field names for link protocol (inside encrypted layer)
# Customize these to avoid structural fingerprinting
[smb_link.malleable]
link_data_field = "ld"                    # Array of linked agent data in POST
link_commands_field = "lc"                # Array of commands for linked agents in GET response
link_handshake_field = "lh"               # Initial handshake from SMB agent
link_handshake_response_field = "lr"      # Handshake response for SMB agent
routing_id_field = "r"                    # Short routing identifier
payload_field = "p"                       # Encrypted payload blob